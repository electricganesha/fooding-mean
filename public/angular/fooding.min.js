(function(){angular.module("fooding",["ngRoute","ngTagsInput","ui.bootstrap"]);function o(o,e){o.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl"}).when("/events",{templateUrl:"/events/events.view.html",controller:"eventsCtrl"}).when("/profile",{templateUrl:"/profile/profile.view.html",controller:"profileCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});e.html5Mode(true)}function e(o,e,n,t){o.$on("$routeChangeStart",function(o,t,i){alert(o);if(e.path()==="/profile"&&!n.isLoggedIn()){e.path("/")}})}angular.module("fooding").config(["$routeProvider","$locationProvider",o])})();(function(){angular.module("fooding").service("authentication",o);o.$inject=["$http","$window"];function o(o,e){var n=function(o){e.localStorage["fooding-token"]=o};var t=function(){return e.localStorage["fooding-token"]};var i=function(){var o=t();var n;if(o){n=o.split(".")[1];n=e.atob(n);n=JSON.parse(n);return n.exp>Date.now()/1e3}else{return false}};var r=function(){if(i()){var o=t();var n=o.split(".")[1];n=e.atob(n);n=JSON.parse(n);return{email:n.email,name:n.name}}};register=function(e){return o.post("/api/register",e).success(function(o){n(o.token)})};login=function(e){return o.post("/api/login",e).success(function(o){n(o.token)})};loginFacebook=function(){window.location=e.location.protocol+"//"+e.location.host+"/api/fblogin"};loginGoogle=function(){window.location=e.location.protocol+"//"+e.location.host+"/api/googlelogin"};logout=function(){e.localStorage.removeItem("fooding-token")};return{currentUser:r,saveToken:n,getToken:t,isLoggedIn:i,register:register,login:login,logout:logout,loginFacebook:loginFacebook,loginGoogle:loginGoogle}}})();(function(){angular.module("fooding").service("meanData",o);o.$inject=["$http","authentication"];function o(o,e){var n=function(o){e.saveToken(o)};var t=function(){e.logout()};var i=function(){if(e.isLoggedIn()){return o.get("/api/profile",{headers:{Authorization:"Bearer "+e.getToken()}})}else{return false}};var r=function(n){if(e.isLoggedIn()){return o.post("/api/profile",{headers:{Authorization:"Bearer "+e.getToken()},profileDataUpdate:n})}else{return false}};return{setExternalToken:n,removeToken:t,getProfile:i,setProfile:r}}})();(function(){angular.module("fooding").controller("homeCtrl",o);o.$inject=["$scope","$uibModal"];function o(o,e){console.log("Home controller is running");o.loginPopup=function(){e.open({templateUrl:"/auth/signin/signin.view.html",controller:"signinCtrl"})};o.registerPopup=function(){e.open({templateUrl:"/auth/register/register.view.html",controller:"registerCtrl"})}}})();(function(){angular.module("fooding").controller("eventsCtrl",o);o.$inject=["$scope","$uibModal"];function o(o,e){console.log("Events controller is running")}})();(function(){angular.module("fooding").controller("profileCtrl",o);o.$inject=["$scope","$route","$location","$http","meanData","$window","authentication"];function o(o,e,n,t,i,r,l){o.pageLoaded=false;if(e.current.params.token==undefined&&!l.isLoggedIn()){window.location=r.location.protocol+"//"+r.location.host+"/"}else{if(e.current.params.token!=undefined){i.setExternalToken(e.current.params.token)}var a=this;a.user={};i.getProfile().success(function(e){a.user=e;o.pageLoaded=true;console.log(a.user.skills);o.profile={email:a.user.email,fullname:a.user.name,nickname:a.user.nickname,address:a.user.address,nif:a.user.nif,telephone:a.user.telephone,tags:a.user.skills,paymentmethod:"nib"};o.profile.tags=[]}).error(function(o){console.log(o)})}a.logout=function(){i.removeToken();e.current.params.token="";window.location=r.location.protocol+"//"+r.location.host+"/api/logout"};o.loadTags=function(o){var e;return t.get("/api/skillsByName")};o.saveProfile=function(){i.setProfile(o.profile).success(function(o){console.log(o)})}}})();(function(){angular.module("fooding").controller("navigationCtrl",o);o.$inject=["$location","authentication"];function o(o,e){var n=this;n.isLoggedIn=e.isLoggedIn();n.currentUser=e.currentUser()}})();(function(){angular.module("fooding").directive("navigation",o);function o(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("fooding").controller("signinCtrl",o);o.$inject=["$scope","$location","authentication","$uibModalInstance"];function o(o,e,n,t){o.credentials={email:"",password:""};o.close=function(){t.close()};o.onSubmit=function(){if(!o.credentials.email||!o.credentials.password){alert("All fields are required");return}else{n.login(o.credentials).error(function(o){alert(o.message)}).then(function(){e.path("profile")})}};o.facebook=function(){n.loginFacebook().error(function(o){alert(o)}).then(function(){e.path("profile")})};o.google=function(){n.loginGoogle().error(function(o){alert(o)}).then(function(){e.path("profile")})}}})();(function(){angular.module("fooding").controller("registerCtrl",o);o.$inject=["$scope","$location","authentication","$uibModalInstance"];function o(o,e,n,t){console.log("Register controller running");o.credentials={name:"",email:"",password:""};o.close=function(){t.close()};o.onSubmit=function(){if(!o.credentials.name||!o.credentials.email||!o.credentials.password){alert("All fields are required");return}else{n.register(o.credentials).error(function(o){alert(o.message)}).then(function(){e.path("profile")})}}}})();