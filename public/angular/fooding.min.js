(function(){angular.module("fooding",["ngRoute","ngTagsInput","ui.bootstrap","socialLogin"]);function e(e,o,n){e.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl"}).when("/events",{templateUrl:"/events/events.view.html",controller:"eventsCtrl"}).when("/profile",{templateUrl:"/profile/profile.view.html",controller:"profileCtrl"}).otherwise({redirectTo:"/"});n.setGoogleKey("416952599363-0bqkju4nen8h6ibe55a3snd1g52umivg.apps.googleusercontent.com");n.setFbKey({appId:"183175235454114",apiVersion:"v2.8"});o.html5Mode(true)}angular.module("fooding").config(["$routeProvider","$locationProvider","socialProvider",e])})();(function(){angular.module("fooding").service("authentication",e);e.$inject=["$http","$window","socialLoginService"];function e(e,o,n){var t=function(e){o.localStorage["token"]=e};var i=function(){return o.localStorage["token"]};var r=function(){var e=i();var n;if(e){n=e.split(".")[1];n=o.atob(n);n=JSON.parse(n);return n.exp>Date.now()/1e3}else{return false}};var l=function(){if(r()){var e=i();var n=e.split(".")[1];n=o.atob(n);n=JSON.parse(n);return{email:n.email,name:n.name}}};register=function(o){return e.post("/api/register",o).success(function(e){t(e.token)})};login=function(o){return e.post("/api/login",o).success(function(e){t(e.token)})};logout=function(){o.localStorage.removeItem("token");n.logout()};return{currentUser:l,saveToken:t,getToken:i,isLoggedIn:r,register:register,login:login,logout:logout}}})();(function(){angular.module("fooding").service("foodingData",e);e.$inject=["$http","authentication"];function e(e,o){var n=function(e){o.saveToken(e)};var t=function(){o.logout()};var i=function(){if(o.isLoggedIn()){return e.get("/api/profile",{headers:{Authorization:"Bearer "+o.getToken()}})}else{return false}};var r=function(n){if(o.isLoggedIn()){return e.post("/api/profile",{headers:{Authorization:"Bearer "+o.getToken()},profileDataUpdate:n})}else{return false}};return{setExternalToken:n,removeToken:t,getProfile:i,setProfile:r}}})();(function(){angular.module("fooding").controller("homeCtrl",e);e.$inject=["$scope","$location","authentication","$uibModal"];function e(e,o,n,t){console.log("Home controller is running");if(n.getToken()!=undefined){o.path("profile")}e.loginPopup=function(){t.open({templateUrl:"/auth/signin/signin.view.html",controller:"signinCtrl"})};e.registerPopup=function(){t.open({templateUrl:"/auth/register/register.view.html",controller:"registerCtrl"})}}})();(function(){angular.module("fooding").controller("eventsCtrl",e);e.$inject=["$scope","$uibModal"];function e(e,o){console.log("Events controller is running")}})();(function(){angular.module("fooding").controller("profileCtrl",e);e.$inject=["$scope","$route","$location","$http","foodingData","$window","authentication"];function e(e,o,n,t,i,r,l){e.pageLoaded=false;if(o.current.params.token==undefined&&!l.isLoggedIn()){window.location=r.location.protocol+"//"+r.location.host+"/"}else{if(o.current.params.token!=undefined){i.setExternalToken(o.current.params.token)}e.user={};i.getProfile().success(function(o){e.user=o;e.pageLoaded=true;e.profile={email:e.user.email,fullname:e.user.name,nickname:e.user.nickname,address:e.user.address,nif:e.user.nif,telephone:e.user.telephone,tags:e.user.skills,paymentmethod:"nib"};e.profile.tags=[]}).error(function(e){console.log(e)})}e.logout=function(){i.removeToken();window.location=r.location.protocol+"//"+r.location.host+"/api/logout"};e.loadTags=function(e){var o;return t.get("/api/skillsByName")};e.saveProfile=function(){i.setProfile(e.profile).success(function(e){console.log(e)})}}})();(function(){angular.module("fooding").controller("signinCtrl",e);e.$inject=["$scope","$location","authentication","$uibModalInstance"];function e(e,o,n,t){e.credentials={email:"",password:""};e.close=function(){t.close()};e.onSubmit=function(){if(!e.credentials.email||!e.credentials.password){alert("All fields are required");return}else{n.login(e.credentials).error(function(e){alert(e.message)}).then(function(){o.path("profile")})}};e.$on("event:social-sign-in-success",function(e,t){console.log(t.token);n.saveToken(t.token);o.path("profile")});e.$on("event:social-sign-out-success",function(e,o){console.log(o)})}})();(function(){angular.module("fooding").controller("registerCtrl",e);e.$inject=["$scope","$location","authentication","$uibModalInstance"];function e(e,o,n,t){console.log("Register controller running");e.credentials={name:"",email:"",password:""};e.close=function(){t.close()};e.onSubmit=function(){if(!e.credentials.name||!e.credentials.email||!e.credentials.password){alert("All fields are required");return}else{n.register(e.credentials).error(function(e){alert(e.message)}).then(function(){o.path("profile")})}}}})();