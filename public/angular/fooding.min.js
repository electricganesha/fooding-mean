(function(){angular.module("fooding",["ngRoute","ngTagsInput","ui.bootstrap","socialLogin","ui.router","ngFileUpload"]);function e(e,t,n,o){e.state("home",{url:"/",views:{content:{templateUrl:"/home/home.view.html",controller:"homeCtrl"}}}).state("foodings",{url:"/foodings",views:{nav:{templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl"},content:{templateUrl:"/events/events.view.html",controller:"eventsCtrl"}}}).state("newfooding",{url:"/newfooding",views:{nav:{templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl"},content:{templateUrl:"/newevent/newevent.view.html",controller:"newEventCtrl"}}}).state("myfoodings",{url:"/myfoodings",views:{nav:{templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl"},content:{templateUrl:"/myevents/myevents.view.html",controller:"myEventsCtrl"}}}).state("profile",{url:"/profile",views:{nav:{templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl"},content:{templateUrl:"/profile/profile.view.html",controller:"profileCtrl"}}}).state("user",{url:"/user/:userId",views:{nav:{templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl"},content:{templateUrl:"/user/user.view.html",controller:"userCtrl"}}});t.otherwise("/");o.setGoogleKey("416952599363-0bqkju4nen8h6ibe55a3snd1g52umivg.apps.googleusercontent.com");o.setFbKey({appId:"183175235454114",apiVersion:"v2.8"});n.html5Mode(true)}angular.module("fooding").config(["$stateProvider","$urlRouterProvider","$locationProvider","socialProvider",e])})();(function(){angular.module("fooding").directive("navigation",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl"}}})();(function(){angular.module("fooding").controller("navigationCtrl",e);e.$inject=["$scope","$uibModal","foodingData","authentication"];function e(e,t,n,o){console.log("Navigation controller is running");if(o.isLoggedIn()){n.getMyProfile().then(function(t){e.userId=t.data._id;e.name=t.data.name;e.profilePic=t.data.profilePic;e.stars=t.data.stars;e.upVotes=t.data.upVotes;e.downVotes=t.data.downVotes}).catch(function(e){console.log(e)})}else{return false}}})();(function(){angular.module("fooding").service("authentication",e);e.$inject=["$http","$window","socialLoginService"];function e(e,t,n){var o=function(e){t.localStorage["token"]=e};var i=function(e){t.localStorage["userId"]=e};var a=function(){return t.localStorage["token"]};var r=function(){return t.localStorage["userId"]};var l=function(){var e=a();var n;if(e){n=e.split(".")[1];n=t.atob(n);n=JSON.parse(n);return n.exp>Date.now()/1e3}else{return false}};var s=function(){if(l()){var e=a();var n=e.split(".")[1];n=t.atob(n);n=JSON.parse(n);return{email:n.email,name:n.name}}};var c=function(t){return e.post("/api/register",t).then(function(e){o(e.data.token);i(e.data.userId)}).catch(function(e){console.log(e)})};var u=function(t){return e.post("/api/login",t).then(function(e){o(e.data.token);i(e.data.userId)}).catch(function(e){console.log(e)})};var g=function(t){return e.post("/api/loginsocial",t).then(function(e){o(e.data.token);i(e.data.userId)}).catch(function(e){console.log(e)})};var f=function(){t.localStorage.removeItem("token");t.localStorage.removeItem("userId");n.logout()};return{currentUser:s,saveToken:o,saveUserId:i,getToken:a,getUserId:r,isLoggedIn:l,register:c,login:u,loginSocial:g,logout:f}}})();(function(){angular.module("fooding").service("categoriesData",e);e.$inject=["$http","authentication"];function e(e,t){var n=function(){if(t.isLoggedIn()){return e.get("/api/categories/appetizers",{headers:{Authorization:"Bearer "+t.getToken()}})}else{return false}};var o=function(){if(t.isLoggedIn()){return e.get("/api/categories/dishes",{headers:{Authorization:"Bearer "+t.getToken()}})}else{return false}};var i=function(){if(t.isLoggedIn()){return e.get("/api/categories/desserts",{headers:{Authorization:"Bearer "+t.getToken()}})}else{return false}};var a=function(){if(t.isLoggedIn()){return e.get("/api/categories/drinks",{headers:{Authorization:"Bearer "+t.getToken()}})}else{return false}};return{getAppetizers:n,getDishes:o,getDesserts:i,getDrinks:a}}})();(function(){angular.module("fooding").service("foodingData",e);e.$inject=["$http","authentication"];function e(e,t){var n=function(e){t.saveToken(e)};var o=function(){t.logout()};var i=function(){if(t.isLoggedIn()){return e.get("/api/profile",{headers:{Authorization:"Bearer "+t.getToken()}})}else{return false}};var a=function(n){if(t.isLoggedIn()){return e.get("/api/profile/"+n,{headers:{Authorization:"Bearer "+t.getToken()}})}else{return false}};var r=function(n){if(t.isLoggedIn()){return e.post("/api/profile",{headers:{Authorization:"Bearer "+t.getToken()},profileDataUpdate:n})}else{return false}};var l=function(n){if(t.isLoggedIn()){return e.get("/api/events",{headers:{Authorization:"Bearer "+t.getToken()}})}else{return false}};var s=function(n){if(t.isLoggedIn()){return e.get("/api/events/"+n,{headers:{Authorization:"Bearer "+t.getToken()}})}else{return false}};var c=function(n){if(t.isLoggedIn()){return e.get("/api/event/"+n,{headers:{Authorization:"Bearer "+t.getToken()}})}else{return false}};return{setExternalToken:n,removeToken:o,getMyProfile:i,getUserProfile:a,setProfile:r,getAllEvents:l,getAllEventsFromUser:s,getEventById:c}}})();(function(){angular.module("fooding").controller("homeCtrl",e);e.$inject=["$scope","$location","authentication","$uibModal"];function e(e,t,n,o){console.log("Home controller is running");e.home=true;if(n.getToken()!=undefined){t.path("foodings")}e.loginPopup=function(){o.open({templateUrl:"/auth/signin/signin.view.html",controller:"signinCtrl"})};e.registerPopup=function(){o.open({templateUrl:"/auth/register/register.view.html",controller:"registerCtrl"})}}})();(function(){angular.module("fooding").controller("eventsCtrl",e);e.$inject=["$scope","$location","$uibModal","foodingData","authentication"];function e(e,t,n,o,i){console.log("Events controller is running");if(i.getToken()==undefined){t.path("home")}o.getAllEvents().then(function(t){e.events=t.data},function(t){e.message="Sorry, something's gone wrong, please try again later"});e.eventPopup=function(e){var t=n.open({animation:true,templateUrl:"/eventpopup/eventpopup.view.html",controller:"eventpopupCtrl",resolve:{eventId:function(){return e}},size:"lg"});t.result.then(function(e){console.log(e)},function(){})};e.childHandler=function(e){e.stopPropagation()}}})();(function(){angular.module("fooding").controller("newEventCtrl",e);e.$inject=["$scope","categoriesData","Upload"];function e(e,t,n){console.log("New Event controller is running");var o=[];e.onTimeSet=function(e,t){console.log(e);console.log(t)};e.selectedAppetizers=[];e.selectedDishes=[];e.selectedDesserts=[];e.selectedDrinks=[];e.first=true;e.second=false;e.third=false;e.toggle=function(e,t){var n=t.indexOf(e);if(n>-1){t.splice(n,1)}else{t.push(e)}};e.exists=function(e,t){return t.indexOf(e)>-1};e.firstNext=function(){e.first=false;e.second=true};e.secondNext=function(){e.second=false;e.third=true};e.secondBack=function(){e.first=true;e.second=false};e.thirdBack=function(){e.second=true;e.third=false};t.getAppetizers().then(function(t){e.appetizers=t.data},function(t){e.message="Sorry, something's gone wrong, please try again later"});t.getDishes().then(function(t){e.dishes=t.data},function(t){e.message="Sorry, something's gone wrong, please try again later"});t.getDesserts().then(function(t){e.desserts=t.data},function(t){e.message="Sorry, something's gone wrong, please try again later"});t.getDrinks().then(function(t){e.drinks=t.data},function(t){e.message="Sorry, something's gone wrong, please try again later"});e.$watch("files",function(){e.upload(e.files)});e.$watch("file",function(){if(e.file!=null){e.files=[e.file]}});e.log="";e.upload=function(t){if(t&&t.length){for(var o=0;o<t.length;o++){var i=t[o];if(!i.$error){console.log(i);n.upload({url:"api/eventcover",data:{file:i}}).then(function(e){document.getElementById("drop-box").style.backgroundImage="url('"+i+"')"},null,function(t){var n=parseInt(100*t.loaded/t.total);e.log="progress: "+n+"% "+t.config.data.file.name+"\n"+e.log})}}}};e.today=function(){e.dt=new Date};e.today();e.clear=function(){e.dt=null};e.inlineOptions={customClass:s,minDate:new Date,showWeeks:true};e.dateOptions={dateDisabled:a,formatYear:"yy",maxDate:new Date(2020,5,22),minDate:new Date,startingDay:1,showWeeks:false};function a(e){var t=e.date,n=e.mode;return n==="day"&&(t.getDay()===0||t.getDay()===6)}e.toggleMin=function(){e.inlineOptions.minDate=e.inlineOptions.minDate?null:new Date;e.dateOptions.minDate=e.inlineOptions.minDate};e.toggleMin();e.open1=function(){e.popup1.opened=true};e.setDate=function(t,n,o){e.dt=new Date(t,n,o)};e.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"];e.format=e.formats[0];e.altInputFormats=["M!/d!/yyyy"];e.popup1={opened:false};var r=new Date;r.setDate(r.getDate()+1);var l=new Date;l.setDate(r.getDate()+1);e.events=[{date:r,status:"full"},{date:l,status:"partially"}];function s(t){var n=t.date,o=t.mode;if(o==="day"){var i=new Date(n).setHours(0,0,0,0);for(var a=0;a<e.events.length;a++){var r=new Date(e.events[a].date).setHours(0,0,0,0);if(i===r){return e.events[a].status}}}return""}e.submit=function(){o.menu=[];if(e.selectedAppetizers.length!=0){o.menu.appetizers=[];for(i=0;i<e.selectedAppetizers.length;i++){o.menu.appetizers[i]=document.getElementsByName(e.selectedAppetizers[i])[0].value}}if(e.selectedDishes.length!=0){o.menu.dishes=[];for(i=0;i<e.selectedDishes.length;i++){o.menu.dishes[i]=document.getElementsByName(e.selectedDishes[i])[0].value}}if(e.selectedDesserts.length!=0){o.menu.desserts=[];for(i=0;i<e.selectedDesserts.length;i++){o.menu.desserts[i]=document.getElementsByName(e.selectedDesserts[i])[0].value}}if(e.selectedDrinks.length!=0){o.menu.drinks=[];for(i=0;i<e.selectedDrinks.length;i++){o.menu.drinks[i]=document.getElementsByName(e.selectedDrinks[i])[0].value}}o.title=document.getElementsByName("eventTitle")[0].value;o.description=document.getElementsByName("eventDescription")[0].value;console.log(document.getElementsByName("eventDescription")[0].value);console.log(o)}}})();(function(){angular.module("fooding").controller("eventpopupCtrl",e);e.$inject=["$scope","foodingData","$uibModalInstance","eventId"];function e(e,t,n,o){console.log("Event Popup controller running");t.getEventById(o).then(function(t){e.event=t.data[0]},function(t){e.message="Sorry, something's gone wrong, please try again later"});e.closePopup=function(){n.close()}}})();(function(){angular.module("fooding").controller("myEventsCtrl",e);e.$inject=["$scope","authentication","foodingData"];function e(e,t,n){console.log("My events controller is running");n.getAllEventsFromUser(t.getUserId()).then(function(t){e.events=t.data},function(t){e.message="Sorry, something's gone wrong, please try again later"})}})();(function(){angular.module("fooding").controller("profileCtrl",e);e.$inject=["$scope","$route","$location","$http","foodingData","$window","authentication"];function e(e,t,n,o,i,a,r){if(r.isLoggedIn()){i.getMyProfile().then(function(t){e.name=t.data.name;e.email=t.data.email}).catch(function(e){console.log(e)})}else{return false}e.logout=function(){i.removeToken();window.location=a.location.protocol+"//"+a.location.host+"/api/logout"};e.loadTags=function(e){var t;return o.get("/api/skillsByName")};e.saveProfile=function(){i.setProfile(e.profile).success(function(e){console.log(e)})}}})();(function(){angular.module("fooding").controller("userCtrl",e);e.$inject=["$scope","$route","$stateParams","$http","foodingData","authentication"];function e(e,t,n,o,i,a){console.log("User profile controller is running");if(a.isLoggedIn()){i.getUserProfile(n.userId).then(function(t){e.name=t.data.name;e.email=t.data.email}).catch(function(e){console.log(e)})}else{return false}}})();(function(){angular.module("fooding").controller("signinCtrl",e);e.$inject=["$scope","$location","authentication","$uibModalInstance"];function e(e,t,n,o){e.credentials={email:"",password:""};e.close=function(){o.close()};e.onSubmit=function(){if(!e.credentials.email||!e.credentials.password){alert("All fields are required");return}else{n.login(e.credentials).catch(function(e){alert(e.message)}).then(function(){o.close();t.path("foodings")})}};e.$on("event:social-sign-in-success",function(e,i){n.loginSocial(i).catch(function(e){alert(e.message)}).then(function(){o.close();t.path("foodings")})});e.$on("event:social-sign-out-success",function(e,t){console.log(t)})}})();(function(){angular.module("fooding").controller("registerCtrl",e);e.$inject=["$scope","$location","authentication","$uibModalInstance"];function e(e,t,n,o){console.log("Register controller running");e.credentials={name:"",email:"",password:""};e.close=function(){o.close()};e.onSubmit=function(){if(!e.credentials.name||!e.credentials.email||!e.credentials.password){alert("All fields are required");return}else{n.register(e.credentials).catch(function(e){alert(e.message)}).then(function(){o.close();t.path("foodings")})}};e.$on("event:social-sign-in-success",function(e,i){n.loginSocial(i).catch(function(e){alert(e.message)}).then(function(){o.close();t.path("foodings")})});e.$on("event:social-sign-out-success",function(e,t){console.log(t)})}})();