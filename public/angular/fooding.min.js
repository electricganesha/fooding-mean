(function(){angular.module("fooding",["ngRoute","ngTagsInput","ui.bootstrap","socialLogin","ui.router"]);function e(e,n,t,o,i){e.state("home",{url:"/",views:{content:{templateUrl:"/home/home.view.html",controller:"homeCtrl"}}}).state("events",{url:"/events",views:{nav:{templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl"},content:{templateUrl:"/events/events.view.html",controller:"eventsCtrl"}}}).state("myfoodings",{url:"/myfoodings",views:{nav:{templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl"},content:{templateUrl:"/myevents/myevents.view.html",controller:"myEventsCtrl"}}}).state("profile",{url:"/profile",views:{nav:{templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl"},content:{templateUrl:"/profile/profile.view.html",controller:"profileCtrl"}}});n.otherwise("/");i.setGoogleKey("416952599363-0bqkju4nen8h6ibe55a3snd1g52umivg.apps.googleusercontent.com");i.setFbKey({appId:"183175235454114",apiVersion:"v2.8"});o.html5Mode(true)}angular.module("fooding").config(["$stateProvider","$urlRouterProvider","$routeProvider","$locationProvider","socialProvider",e])})();(function(){angular.module("fooding").directive("navigation",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl"}}})();(function(){angular.module("fooding").controller("navigationCtrl",e);e.$inject=["$scope","$uibModal","foodingData","authentication"];function e(e,n,t,o){console.log("Navigation controller is running");if(o.isLoggedIn()){t.getProfile().then(function(n){e.name=n.data.name;e.profilePic=n.data.profilePic;e.stars=n.data.stars;e.upVotes=n.data.upVotes;e.downVotes=n.data.downVotes}).catch(function(e){console.log(e)})}else{return false}e.newEventPopup=function(){n.open({templateUrl:"/events/newevent.view.html",controller:"newEventCtrl",size:"lg"})}}})();(function(){angular.module("fooding").service("authentication",e);e.$inject=["$http","$window","socialLoginService"];function e(e,n,t){var o=function(e){n.localStorage["token"]=e};var i=function(e){n.localStorage["userId"]=e};var r=function(){return n.localStorage["token"]};var a=function(){return n.localStorage["userId"]};var l=function(){var e=r();var t;if(e){t=e.split(".")[1];t=n.atob(t);t=JSON.parse(t);return t.exp>Date.now()/1e3}else{return false}};var c=function(){if(l()){var e=r();var t=e.split(".")[1];t=n.atob(t);t=JSON.parse(t);return{email:t.email,name:t.name}}};var s=function(n){return e.post("/api/register",n).then(function(e){o(e.data.token);i(e.data.userId)}).catch(function(e){console.log(e)})};var u=function(n){return e.post("/api/login",n).then(function(e){o(e.data.token);i(e.data.userId)}).catch(function(e){console.log(e)})};var g=function(n){return e.post("/api/loginsocial",n).then(function(e){o(e.data.token);i(e.data.userId)}).catch(function(e){console.log(e)})};var f=function(){n.localStorage.removeItem("token");n.localStorage.removeItem("userId");t.logout()};return{currentUser:c,saveToken:o,saveUserId:i,getToken:r,getUserId:a,isLoggedIn:l,register:s,login:u,loginSocial:g,logout:f}}})();(function(){angular.module("fooding").service("foodingData",e);e.$inject=["$http","authentication"];function e(e,n){var t=function(e){n.saveToken(e)};var o=function(){n.logout()};var i=function(){if(n.isLoggedIn()){return e.get("/api/profile",{headers:{Authorization:"Bearer "+n.getToken()}})}else{return false}};var r=function(t){if(n.isLoggedIn()){return e.post("/api/profile",{headers:{Authorization:"Bearer "+n.getToken()},profileDataUpdate:t})}else{return false}};var a=function(t){if(n.isLoggedIn()){return e.get("/api/events",{headers:{Authorization:"Bearer "+n.getToken()}})}else{return false}};var l=function(t){if(n.isLoggedIn()){return e.get("/api/events/"+t,{headers:{Authorization:"Bearer "+n.getToken()}})}else{return false}};var c=function(t){if(n.isLoggedIn()){return e.get("/api/event/"+t,{headers:{Authorization:"Bearer "+n.getToken()}})}else{return false}};return{setExternalToken:t,removeToken:o,getProfile:i,setProfile:r,getAllEvents:a,getAllEventsFromUser:l,getEventById:c}}})();(function(){angular.module("fooding").controller("homeCtrl",e);e.$inject=["$scope","$location","authentication","$uibModal"];function e(e,n,t,o){console.log("Home controller is running");e.home=true;if(t.getToken()!=undefined){n.path("events")}e.loginPopup=function(){o.open({templateUrl:"/auth/signin/signin.view.html",controller:"signinCtrl"})};e.registerPopup=function(){o.open({templateUrl:"/auth/register/register.view.html",controller:"registerCtrl"})}}})();(function(){angular.module("fooding").controller("eventsCtrl",e);e.$inject=["$scope","$location","$uibModal","foodingData","authentication"];function e(e,n,t,o,i){console.log("Events controller is running");if(i.getToken()==undefined){n.path("home")}o.getAllEvents().then(function(n){e.events=n.data},function(n){e.message="Sorry, something's gone wrong, please try again later"});e.eventPopup=function(e){t.open({templateUrl:"/eventpopup/eventpopup.view.html",controller:"eventpopupCtrl",resolve:{eventId:function(){return e}},size:"lg"})}}})();(function(){angular.module("fooding").controller("newEventCtrl",e);e.$inject=["$scope","$uibModal","foodingData"];function e(e,n,t){console.log("New Event controller is running")}})();(function(){angular.module("fooding").controller("eventpopupCtrl",e);e.$inject=["$scope","$location","authentication","foodingData","$uibModalInstance","eventId"];function e(e,n,t,o,i,r){console.log("Event Popup controller running");o.getEventById(r).then(function(n){e.event=n.data[0]},function(n){e.message="Sorry, something's gone wrong, please try again later"});e.close=function(){i.close()}}})();(function(){angular.module("fooding").controller("myEventsCtrl",e);e.$inject=["$scope","$uibModal","authentication","foodingData"];function e(e,n,t,o){console.log("My events controller is running");o.getAllEventsFromUser(t.getUserId()).then(function(n){e.events=n.data},function(n){e.message="Sorry, something's gone wrong, please try again later"})}})();(function(){angular.module("fooding").controller("profileCtrl",e);e.$inject=["$scope","$route","$location","$http","foodingData","$window","authentication"];function e(e,n,t,o,i,r,a){if(a.isLoggedIn()){i.getProfile().then(function(n){e.name=n.data.name;e.email=n.data.email}).catch(function(e){console.log(e)})}else{return false}e.logout=function(){i.removeToken();window.location=r.location.protocol+"//"+r.location.host+"/api/logout"};e.loadTags=function(e){var n;return o.get("/api/skillsByName")};e.saveProfile=function(){i.setProfile(e.profile).success(function(e){console.log(e)})}}})();(function(){angular.module("fooding").controller("signinCtrl",e);e.$inject=["$scope","$location","authentication","$uibModalInstance"];function e(e,n,t,o){e.credentials={email:"",password:""};e.close=function(){o.close()};e.onSubmit=function(){if(!e.credentials.email||!e.credentials.password){alert("All fields are required");return}else{t.login(e.credentials).catch(function(e){alert(e.message)}).then(function(){o.close();n.path("events")})}};e.$on("event:social-sign-in-success",function(e,i){t.loginSocial(i).catch(function(e){alert(e.message)}).then(function(){o.close();n.path("events")})});e.$on("event:social-sign-out-success",function(e,n){console.log(n)})}})();(function(){angular.module("fooding").controller("registerCtrl",e);e.$inject=["$scope","$location","authentication","$uibModalInstance"];function e(e,n,t,o){console.log("Register controller running");e.credentials={name:"",email:"",password:""};e.close=function(){o.close()};e.onSubmit=function(){if(!e.credentials.name||!e.credentials.email||!e.credentials.password){alert("All fields are required");return}else{t.register(e.credentials).catch(function(e){alert(e.message)}).then(function(){o.close();n.path("events")})}};e.$on("event:social-sign-in-success",function(e,i){t.loginSocial(i).catch(function(e){alert(e.message)}).then(function(){o.close();n.path("events")})});e.$on("event:social-sign-out-success",function(e,n){console.log(n)})}})();